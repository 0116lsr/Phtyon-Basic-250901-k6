# 📚 6장: 데이터 분석 라이브러리 완전 가이드

## 🎯 학습 목표
- NumPy의 배열 연산과 수치 계산 방법 이해
- Pandas의 데이터프레임과 시리즈 활용법 학습
- Matplotlib을 이용한 데이터 시각화 기법 익히기
- 실전 데이터 분석 프로젝트 수행 능력 향상
- 데이터 분석 워크플로우 전체 과정 이해

## 📖 핵심 개념

### 1. NumPy (Numerical Python)
**정의**: 대규모 다차원 배열과 행렬 연산을 위한 라이브러리

#### 1.1 기본 배열 생성
```python
import numpy as np

# 1차원 배열
arr1d = np.array([1, 2, 3, 4, 5])
print(arr1d)  # [1 2 3 4 5]

# 2차원 배열 (행렬)
arr2d = np.array([[1, 2, 3], [4, 5, 6]])
print(arr2d)
# [[1 2 3]
#  [4 5 6]]

# 특수 배열 생성
zeros = np.zeros((3, 4))        # 0으로 채운 배열
ones = np.ones((2, 3))          # 1로 채운 배열
range_arr = np.arange(0, 10, 2) # 0부터 10까지 2씩 증가
linspace_arr = np.linspace(0, 1, 5)  # 0부터 1까지 5개 구간
```

#### 1.2 배열 연산
```python
# 벡터화 연산 (반복문 없이)
arr = np.array([1, 2, 3, 4, 5])
result = arr * 2  # 모든 요소에 2 곱하기
print(result)  # [2 4 6 8 10]

# 배열 간 연산
arr1 = np.array([1, 2, 3])
arr2 = np.array([4, 5, 6])
sum_arr = arr1 + arr2  # [5 7 9]
mult_arr = arr1 * arr2  # [4 10 18]

# 통계 함수
data = np.array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
print(f"평균: {np.mean(data)}")
print(f"표준편차: {np.std(data)}")
print(f"최댓값: {np.max(data)}")
print(f"최솟값: {np.min(data)}")
```

#### 1.3 배열 인덱싱과 슬라이싱
```python
# 2차원 배열 생성
matrix = np.array([[1, 2, 3, 4],
                   [5, 6, 7, 8],
                   [9, 10, 11, 12]])

# 인덱싱
print(matrix[1, 2])      # 7 (1행 2열)
print(matrix[0, :])      # [1 2 3 4] (0행 전체)
print(matrix[:, 1])      # [2 6 10] (1열 전체)

# 슬라이싱
print(matrix[0:2, 1:3])  # [[2 3], [6 7]] (0-1행, 1-2열)
print(matrix[::2, ::2])  # [[1 3], [9 11]] (2칸씩 건너뛰기)
```

### 2. Pandas (Panel Data)
**정의**: 표 형태의 데이터를 쉽게 처리할 수 있는 라이브러리

#### 2.1 Series (1차원 데이터)
```python
import pandas as pd

# Series 생성
data = [10, 20, 30, 40, 50]
index = ['A', 'B', 'C', 'D', 'E']
series = pd.Series(data, index=index)
print(series)
# A    10
# B    20
# C    30
# D    40
# E    50
# dtype: int64

# Series 연산
print(series * 2)        # 모든 값에 2 곱하기
print(series[series > 25])  # 25보다 큰 값들
print(series.describe())    # 통계 요약
```

#### 2.2 DataFrame (2차원 데이터)
```python
# DataFrame 생성
data = {
    '이름': ['김철수', '이영희', '박민수', '최지영'],
    '나이': [25, 30, 35, 28],
    '직업': ['개발자', '디자이너', '매니저', '개발자'],
    '급여': [5000, 4500, 6000, 5200]
}
df = pd.DataFrame(data)
print(df)

# 데이터 선택
print(df['이름'])                    # 특정 열 선택
print(df[['이름', '급여']])          # 여러 열 선택
print(df[df['나이'] > 30])           # 조건으로 행 선택
print(df.loc[0:2, ['이름', '직업']])  # 행과 열 동시 선택

# 데이터 수정
df['급여_만원'] = df['급여'] / 1000  # 새 열 추가
df.loc[df['나이'] > 30, '급여'] *= 1.1  # 조건부 수정
```

#### 2.3 데이터 처리
```python
# 결측치 처리
df_with_na = pd.DataFrame({
    'A': [1, 2, None, 4],
    'B': [5, None, 7, 8],
    'C': [9, 10, 11, None]
})

print(df_with_na.isnull())           # 결측치 확인
df_cleaned = df_with_na.fillna(0)    # 결측치를 0으로 채우기
df_dropped = df_with_na.dropna()     # 결측치가 있는 행 제거

# 그룹화
grouped = df.groupby('직업')['급여'].mean()  # 직업별 평균 급여
print(grouped)

# 정렬
df_sorted = df.sort_values('급여', ascending=False)  # 급여 내림차순 정렬
print(df_sorted)
```

### 3. Matplotlib (시각화)
**정의**: 데이터를 그래프로 시각화하는 라이브러리

#### 3.1 기본 그래프
```python
import matplotlib.pyplot as plt
import numpy as np

# 한글 폰트 설정 (Windows)
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

# 선 그래프
x = np.linspace(0, 10, 100)
y = np.sin(x)
plt.plot(x, y, label='sin(x)')
plt.xlabel('X축')
plt.ylabel('Y축')
plt.title('사인 함수')
plt.legend()
plt.grid(True)
plt.show()

# 막대 그래프
categories = ['A', 'B', 'C', 'D']
values = [23, 45, 56, 78]
plt.bar(categories, values)
plt.xlabel('카테고리')
plt.ylabel('값')
plt.title('막대 그래프')
plt.show()

# 산점도
x = np.random.randn(100)
y = 2 * x + np.random.randn(100)
plt.scatter(x, y, alpha=0.6)
plt.xlabel('X')
plt.ylabel('Y')
plt.title('산점도')
plt.show()
```

#### 3.2 고급 시각화
```python
# 히스토그램
data = np.random.normal(0, 1, 1000)
plt.hist(data, bins=30, alpha=0.7, edgecolor='black')
plt.xlabel('값')
plt.ylabel('빈도')
plt.title('히스토그램')
plt.show()

# 여러 그래프 한 번에
fig, axes = plt.subplots(2, 2, figsize=(10, 8))

# 첫 번째 그래프
axes[0, 0].plot([1, 2, 3, 4], [1, 4, 2, 3])
axes[0, 0].set_title('선 그래프')

# 두 번째 그래프
axes[0, 1].bar(['A', 'B', 'C'], [3, 7, 2])
axes[0, 1].set_title('막대 그래프')

# 세 번째 그래프
axes[1, 0].scatter(np.random.rand(50), np.random.rand(50))
axes[1, 0].set_title('산점도')

# 네 번째 그래프
axes[1, 1].hist(np.random.randn(1000), bins=20)
axes[1, 1].set_title('히스토그램')

plt.tight_layout()
plt.show()
```

## 🔧 실습 예제

### 예제 1: 주식 데이터 분석
```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# 가상의 주식 데이터 생성
dates = pd.date_range('2024-01-01', periods=100, freq='D')
np.random.seed(42)
prices = 100 + np.cumsum(np.random.randn(100) * 0.5)

# DataFrame 생성
df = pd.DataFrame({
    'Date': dates,
    'Price': prices,
    'Volume': np.random.randint(1000, 10000, 100)
})

# 이동평균 계산
df['MA_5'] = df['Price'].rolling(window=5).mean()
df['MA_20'] = df['Price'].rolling(window=20).mean()

# 시각화
plt.figure(figsize=(12, 6))
plt.plot(df['Date'], df['Price'], label='주가', alpha=0.7)
plt.plot(df['Date'], df['MA_5'], label='5일 이동평균')
plt.plot(df['Date'], df['MA_20'], label='20일 이동평균')
plt.xlabel('날짜')
plt.ylabel('가격')
plt.title('주식 가격 및 이동평균')
plt.legend()
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()

# 통계 분석
print("=== 주식 데이터 분석 ===")
print(f"평균 가격: {df['Price'].mean():.2f}")
print(f"최고 가격: {df['Price'].max():.2f}")
print(f"최저 가격: {df['Price'].min():.2f}")
print(f"가격 변동성: {df['Price'].std():.2f}")
```

### 예제 2: 고객 데이터 분석
```python
# 고객 데이터 생성
np.random.seed(42)
n_customers = 1000

data = {
    '고객ID': range(1, n_customers + 1),
    '나이': np.random.normal(35, 10, n_customers).astype(int),
    '성별': np.random.choice(['남성', '여성'], n_customers),
    '지역': np.random.choice(['서울', '부산', '대구', '인천'], n_customers),
    '구매금액': np.random.exponential(50, n_customers),
    '구매횟수': np.random.poisson(3, n_customers)
}

df = pd.DataFrame(data)
df['나이'] = np.clip(df['나이'], 18, 80)  # 나이 범위 제한

# 기본 통계
print("=== 고객 데이터 요약 ===")
print(df.describe())

# 성별별 분석
gender_analysis = df.groupby('성별').agg({
    '구매금액': ['mean', 'sum'],
    '구매횟수': 'mean'
}).round(2)
print("\n=== 성별별 분석 ===")
print(gender_analysis)

# 지역별 분석
region_analysis = df.groupby('지역')['구매금액'].agg(['count', 'mean', 'sum']).round(2)
print("\n=== 지역별 분석 ===")
print(region_analysis)

# 시각화
fig, axes = plt.subplots(2, 2, figsize=(15, 10))

# 나이 분포
axes[0, 0].hist(df['나이'], bins=20, alpha=0.7, edgecolor='black')
axes[0, 0].set_title('나이 분포')
axes[0, 0].set_xlabel('나이')
axes[0, 0].set_ylabel('고객 수')

# 성별별 구매금액
df.boxplot(column='구매금액', by='성별', ax=axes[0, 1])
axes[0, 1].set_title('성별별 구매금액')
axes[0, 1].set_xlabel('성별')
axes[0, 1].set_ylabel('구매금액')

# 지역별 평균 구매금액
region_means = df.groupby('지역')['구매금액'].mean()
axes[1, 0].bar(region_means.index, region_means.values)
axes[1, 0].set_title('지역별 평균 구매금액')
axes[1, 0].set_xlabel('지역')
axes[1, 0].set_ylabel('평균 구매금액')

# 구매금액 vs 구매횟수 산점도
axes[1, 1].scatter(df['구매횟수'], df['구매금액'], alpha=0.6)
axes[1, 1].set_title('구매횟수 vs 구매금액')
axes[1, 1].set_xlabel('구매횟수')
axes[1, 1].set_ylabel('구매금액')

plt.tight_layout()
plt.show()
```

### 예제 3: 실시간 데이터 시뮬레이션
```python
import time
from datetime import datetime, timedelta

def simulate_real_time_data():
    """실시간 데이터 시뮬레이션"""
    # 초기 데이터
    base_price = 100
    prices = [base_price]
    times = [datetime.now()]
    
    plt.ion()  # 인터랙티브 모드
    
    fig, ax = plt.subplots(figsize=(10, 6))
    line, = ax.plot([], [], 'b-', linewidth=2)
    ax.set_xlabel('시간')
    ax.set_ylabel('가격')
    ax.set_title('실시간 가격 변동')
    ax.grid(True)
    
    # 30초간 데이터 생성
    for i in range(30):
        # 가격 변동 (랜덤 워크)
        change = np.random.normal(0, 0.5)
        new_price = prices[-1] + change
        prices.append(new_price)
        times.append(datetime.now())
        
        # 최근 20개 데이터만 표시
        if len(prices) > 20:
            prices = prices[-20:]
            times = times[-20:]
        
        # 그래프 업데이트
        line.set_data(range(len(prices)), prices)
        ax.relim()
        ax.autoscale_view()
        
        plt.draw()
        plt.pause(1)  # 1초 대기
        
        print(f"시간: {times[-1].strftime('%H:%M:%S')}, 가격: {new_price:.2f}")
    
    plt.ioff()
    plt.show()

# 실행 (주석 해제하여 실행)
# simulate_real_time_data()
```

## ⚠️ 주의사항

1. **메모리 사용량**:
   - 대용량 데이터 처리 시 메모리 부족 주의
   - 청크 단위로 처리하거나 샘플링 고려

2. **데이터 타입**:
   - Pandas는 자동으로 데이터 타입 추론
   - 명시적으로 타입 지정하는 것이 좋음

3. **인덱스 관리**:
   - 인덱스가 중복되거나 정렬되지 않을 수 있음
   - `reset_index()` 또는 `sort_index()` 사용

4. **시각화**:
   - 한글 폰트 설정 필수
   - 그래프 크기와 해상도 고려

5. **성능 최적화**:
   - 벡터화 연산 사용
   - 반복문 대신 내장 함수 활용

## 🎯 학습 체크리스트

- [ ] NumPy 배열 생성과 기본 연산하기
- [ ] Pandas DataFrame으로 데이터 로드하고 처리하기
- [ ] Matplotlib으로 다양한 그래프 그리기
- [ ] 데이터 정제와 전처리 수행하기
- [ ] 통계 분석과 집계 함수 사용하기
- [ ] 시계열 데이터 분석하기
- [ ] 실전 데이터 분석 프로젝트 수행하기
- [ ] 데이터 시각화로 인사이트 도출하기

## 🔗 관련 링크

- [NumPy 공식 문서](https://numpy.org/doc/stable/)
- [Pandas 공식 문서](https://pandas.pydata.org/docs/)
- [Matplotlib 공식 문서](https://matplotlib.org/stable/)
- [이전 챕터: 객체지향 프로그래밍](./05-객체지향프로그래밍.md)
- [전체 학습 가이드 인덱스](./00-학습가이드인덱스.md)
